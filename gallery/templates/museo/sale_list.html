{% extends "museo/base.html" %}
{% load static %}

{% block title %}Sale – Museo{% endblock %}

{% block content %}
<h1 class="mb-4">Sale espositive</h1>

<!-- GRIGLIA CARD SALE -->
<section id="contenitore-sale" class="row g-4">
  {# Le card verranno iniettate via JS/AJAX #}
</section>

<!-- PAGINAZIONE -->
<nav class="d-flex justify-content-between align-items-center mt-4" aria-label="Paginazione sale">
  <button id="precedente" class="btn btn-outline-secondary" disabled>« Precedente</button>
  <button id="successivo" class="btn btn-outline-secondary">Successivo »</button>
</nav>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
/* =======================================================================
   AJAX  ➜  /api/sale/  (definisci questa rotta in urls.py)
   ======================================================================= */
let tutteLeSale   = [];
let paginaCorrente = 1;
const perPagina    = 10;

$(function () {
  // 1) Carica tutte le sale al load
  $.getJSON("{% url 'api_sale_list' %}", data => {
    tutteLeSale = data;
    mostraPagina(1);
  });

  // 2) Pulsanti paginazione
  $('#successivo').on('click', () => { paginaCorrente++; mostraPagina(paginaCorrente); });
  $('#precedente').on('click', () => { paginaCorrente--; mostraPagina(paginaCorrente); });
});

function mostraPagina(pagina) {
  const start = (pagina - 1) * perPagina;
  const end   = pagina * perPagina;
  const salePagina = tutteLeSale.slice(start, end);

  const $contenitore = $('#contenitore-sale').empty();

  if (!salePagina.length) {
    $contenitore.append('<p class="text-center">Nessuna sala disponibile.</p>');
  } else {
    salePagina.forEach(sala => {
      $contenitore.append(`
        <div class="col-sm-6 col-lg-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title">${sala.nome}</h5>
              <p class="card-text mb-1"><strong>Superficie:</strong> ${sala.superficie} m²</p>
              <p class="card-text"><strong>Tema:</strong> ${sala.tema}</p>
            </div>
          </div>
        </div>
      `);
    });
  }

  $('#precedente').prop('disabled', pagina === 1);
  $('#successivo').prop('disabled', end >= tutteLeSale.length);
}
</script>
{% endblock %}
